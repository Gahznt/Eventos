{# src/layouts/base.html.twig #}
{% extends 'base.html.twig' %}
{% block body %}
    <div class="container">
        <nav>
            <div class="nav nav-tabs" id="nav-tab" role="tablist">
                <a class="nav-item nav-link tab-6 active" id="nav-1" data-toggle="tab" href="#tab-1" role="tab">
                    {{ 'LISTAGEM DE<br/>TESES'|trans|raw }}
                </a>
            </div>
        </nav>
        <div class="tab-content">
            <div class="tab-pane fade show active" id="tab-1" role="tabpanel">

                <div class="row">
                    <div class="col-md-10">
                        <h1 class="mb-0">{{ 'Listagem de Teses'|trans }}</h1>
                    </div>
                    <div class="col-md-2">
                        <a href="{{ path('system_evaluation_thesis', {'edition' : edition.id, 'export': 'excel'}) }}" class="btn btn-primary float-right mr-1" data-toggle="tooltip" title="{{ 'Baixar Excel'|trans }}">
                            <i class="fas fa-file-excel"></i>
                        </a>
                    </div>
                </div>

                {% for message in app.flashes('success') %}
                    <div class="alert alert-success mt-3">
                        {{ message |trans }}
                    </div>
                {% endfor %}
                {% for message in app.flashes('error') %}
                    <div class="alert alert-danger mt-3">
                        {{ message |trans }}
                    </div>
                {% endfor %}

                <div class="form mt-3">
                    {{ form_start(form) }}
                    <div class="row">
                        <div class="col-6 col-md-5">
                            {{ form_label(form.division, 'Divisão') }}
                            {{ form_widget(form.division, {'attr': {'class': 'filter form-control'}}) }}
                        </div>
                        <div class="col-6 col-md-7">
                            {{ form_label(form.theme, 'Tema') }}
                            {{ form_widget(form.theme, {'attr': {'class': 'form-control','data-route': path('get_by_division'), 'data-select': 'Select'|trans}}) }}
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-6 col-md-3">
                            {{ form_label(form.status, 'Status') }}
                            {{ form_widget(form.status, {'attr': {'class': 'filter form-control'}}) }}
                        </div>
                        <div class="col-6 col-md-6 col-lg-7">
                            {{ form_label(form.q, 'Buscar') }}
                            {{ form_widget(form.q, {'attr': {'class': 'filter form-control'}}) }}
                        </div>
                        <div class="col-6 col-md-3 col-lg-2" style="padding-top: 31px;">
                            <button type="submit" class="btn btn-primary btn-lg btn-block">Filtrar</button>
                        </div>
                    </div>
                    {{ form_end(form) }}
                </div>

                {% if thesis is empty %}
                    <div class="alert alert-warning mt-3" role="alert">
                        {{ 'Nenhum resultado encontrado.'|trans }}
                    </div>
                {% else %}
                    <div class="tabela my-2 mt-4">
                        <table class="table table-sm table-striped table-responsive-md">
                            <thead>
                            <tr>
                                <th>{{ 'ID'|trans }}</th>
                                <th>{{ 'Título'|trans }}</th>
                                <th>{{ 'Idioma'|trans }}</th>
                                <th>{{ 'Divisão'|trans }}</th>
                                <th>{{ 'Tema'|trans }}</th>
                                <th>{{ 'Modalidade'|trans }}</th>
                                <th>{{ 'Author'|trans }}</th>
                                <th>{{ 'Orientador'|trans }}</th>
                                <th>{{ 'Status'|trans }}</th>
                                <th>{{ 'Confirmada?'|trans }}</th>
                                <th class="text-center" width="100">{{ 'Download'|trans }}</th>
                                <th class="text-center" width="100">{{ 'Ações'|trans }}</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for entity in thesis %}
                                <tr>
                                    <td>{{ entity.id }}</td>
                                    <td>{{ entity.title }}</td>
                                    <td>{{ constant('LANGUAGE', entity)|array_flip()[entity.language]|trans }}</td>
                                    <td>{{ entity.division.initials }}</td>
                                    <td>{{ entity.userThemes.position }} - {{ entity.userThemes.details.title }}</td>
                                    <td>{{ constant('MODALITIES', entity)|array_flip()[entity.modality]|trans }}</td>
                                    <td>{{ entity.user.name }}</td>
                                    <td>{{ entity.advisorName }}</td>
                                    <td>
                                        <span class="badge badge-nl badge-{{ entity.status|article_evaluation_status('color') }}">
                                        {{ constant('EVALUATION_STATUS', entity)|array_flip()[entity.status]|trans }}
                                        </span>
                                    </td>
                                    <td class="text-center">{{ (entity.confirmed == true) ? 'Sim' : 'Não' }}</td>
                                    <td class="text-center">
                                        {% if entity.thesisFilePath is not empty %}
                                            <a href="{{ asset(constant('PUBLIC_PATH', entity) ~ edition.id ~ '/' ~ entity.thesisFilePath) }}" data-toggle="tooltip" class="hover-success" target="_blank" title="{{ 'Arquivo da Tese'|trans }}">
                                                <i class="fas fa-download"></i>
                                            </a>
                                        {% endif %}
                                        {% if entity.agreementFilePath is not empty %}
                                            <a href="{{ asset(constant('PUBLIC_PATH', entity) ~ edition.id ~ '/' ~ entity.agreementFilePath) }}" data-toggle="tooltip" class="hover-success ml-2" target="_blank" title="{{ 'Declaração de Concordância'|trans }}">
                                                <i class="fas fa-download"></i>
                                            </a>
                                        {% endif %}
                                    </td>
                                    <td class="text-center">
                                        <a href="{{ path('system_evaluation_thesis_show', {'id' : entity.id, 'edition': edition.id}) }}" data-toggle="tooltip" class="hover-primary mr-2" title="{{ 'Detalhes'|trans }}">
                                            <i class="fas fa-eye"></i>
                                        </a>

                                        {% if entity.status == constant('EVALUATION_STATUS_WAITING', entity) or entity.status == constant('EVALUATION_STATUS_REPROVED', entity) %}
                                            <a href="{{ path('system_evaluation_thesis_update_status', {'id' : entity.id, 'edition': edition.id, 'status': 'approved'}) }}" data-toggle="tooltip" class="hover-success" title="{{ 'Aprovar'|trans }}">
                                                <i class="fas fa-check"></i>
                                            </a>
                                        {% endif %}

                                        {% if entity.status == constant('EVALUATION_STATUS_WAITING', entity) or entity.status == constant('EVALUATION_STATUS_APPROVED', entity) %}
                                            <a href="{{ path('system_evaluation_thesis_update_status', {'id' : entity.id, 'edition': edition.id, 'status': 'reproved'}) }}" data-toggle="tooltip" class="hover-danger" title="{{ 'Reprovar'|trans }}">
                                                <i class="fas fa-ban"></i>
                                            </a>
                                        {% endif %}
                                    </td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                        <nav class="d-flex justify-content-between" style="float: right">
                            {{ knp_pagination_render(thesis) }}
                        </nav>
                        <small class="text-muted">{{ 'Showing'|trans }} {{ thesis|length }} {{ 'of' |trans }} {{ thesis.getTotalItemCount }}</small>
                    </div>
                {% endif %}

            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {{ encore_entry_script_tags('systemEvaluationThesis') }}
{% endblock %}
