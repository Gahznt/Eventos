{# src/layouts/base.html.twig #}
{% extends 'base.html.twig' %}
{% block body %}
    <div class="container">
        <nav>
            <div class="nav nav-tabs" id="nav-tab" role="tablist">
                <a class="nav-item nav-link tab-6 active" id="nav-1" data-toggle="tab" href="#tab-1" role="tab">
                    {{ 'LISTAGEM DE<br/>ATIVIDADES'|trans|raw }}
                </a>
            </div>
        </nav>
        <div class="tab-content">
            <div class="tab-pane fade show active" id="tab-1" role="tabpanel">

                <div class="row">
                    <div class="col-md-10">
                        <h1 class="mb-0">{{ 'Listagem de Atividades'|trans }}</h1>
                    </div>
                    <div class="col-md-2">
                        <a href="{{ path('system_evaluation_activities', {'edition' : edition.id, 'export': 'excel'}) }}" class="btn btn-primary float-right mr-1" data-toggle="tooltip" title="{{ 'Baixar Excel'|trans }}">
                            <i class="fas fa-file-excel"></i>
                        </a>
                    </div>
                </div>

                {% for message in app.flashes('success') %}
                    <div class="alert alert-success mt-3">
                        {{ message |trans }}
                    </div>
                {% endfor %}
                {% for message in app.flashes('error') %}
                    <div class="alert alert-danger mt-3">
                        {{ message |trans }}
                    </div>
                {% endfor %}

                <div class="form mt-3">
                    {{ form_start(form) }}
                    <div class="row">
                        <div class="col-6 col-md-3">
                            {{ form_label(form.type, 'Tipo') }}
                            {{ form_widget(form.type, {'attr': {'class': 'filter form-control'}}) }}
                        </div>
                        <div class="col-6 col-md-3">
                            {{ form_label(form.division, 'Divisão') }}
                            {{ form_widget(form.division, {'attr': {'class': 'filter form-control'}}) }}
                        </div>
                        <div class="col-6 col-md-3 col-lg-4">
                            {{ form_label(form.q, 'Buscar') }}
                            {{ form_widget(form.q, {'attr': {'class': 'filter form-control'}}) }}
                        </div>
                        <div class="col-6 col-md-3 col-lg-2" style="padding-top: 31px;">
                            <button type="submit" class="btn btn-primary btn-lg btn-block">Filtrar</button>
                        </div>
                    </div>
                    {{ form_end(form) }}
                </div>

                {% if activities is empty %}
                    <div class="alert alert-warning mt-3" role="alert">
                        Nenhum resultado encontrado.
                    </div>
                {% else %}
                    <div class="tabela my-2 mt-4">
                        <table class="table table-sm table-striped table-responsive-md">
                            <thead>
                            <tr>
                                <th>{{ 'Tipo'|trans }}</th>
                                <th>{{ 'Divisão'|trans }}</th>
                                <th>{{ 'Idioma'|trans }}</th>
                                <th>{{ 'Título'|trans }}</th>
                                <th>{{ 'Descrição'|trans }}</th>
                                <th>{{ 'Painelistas'|trans }}</th>
                                <th>{{ 'Convidados'|trans }}</th>
                                <th class="text-center" width="100">{{ 'Ações'|trans }}</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for activity in activities %}
                                {% set panelists = [] %}

                                {% if activity.panelists|length > 0 %}
                                    {% for panelist in activity.panelists %}
                                        {% set panelists = panelists|merge({(loop.index):panelist.panelist.name}) %}
                                    {% endfor %}
                                {% endif %}

                                {% set guests = [] %}

                                {% if activity.guests|length > 0 %}
                                    {% for guest in activity.guests %}
                                        {% set name = guest.name %}
                                        {% if name is empty and guest.guest is not empty %}
                                            {% set name = guest.guest.name %}
                                        {% endif %}
                                        {% set guests = guests|merge({(loop.index):name}) %}
                                    {% endfor %}
                                {% endif %}

                                <tr>
                                    <td>{{ constant('ACTIVITY_TYPES', activity)|array_flip()[activity.activityType]|trans }}</td>
                                    <td>
                                        {% if 1 == activity.isGlobal %}
                                            ANPAD
                                        {% else %}
                                            {{ activity.division.name }}
                                        {% endif %}
                                    </td>
                                    <td>{{ constant('ACTIVITY_LANGUAGES', activity)|array_flip()[activity.language]|trans }}</td>
                                    <td>{{ activity.titlePortuguese }}</td>
                                    <td>{{ activity.descriptionPortuguese|raw }}</td>
                                    <td class="text-nowrap">{{ panelists|join("<br>")|raw }}</td>
                                    <td class="text-nowrap">{{ guests|join("<br>")|raw }}</td>
                                    <td class="text-center">
                                        <a href="{{ path('system_evaluation_activities_show', {'id' : activity.id, 'edition': edition.id}) }}" data-toggle="tooltip" class="hover-success viewActivity" title="{{ 'Detalhes'|trans }}">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                        <a href="{{ path('system_evaluation_activities_edit', {'id' : activity.id, 'edition': edition.id}) }}" data-toggle="tooltip" class="hover-success editActivity ml-2" title="{{ 'Editar'|trans }}">
                                            <i class="fas fa-pencil-alt"></i>
                                        </a>
                                    </td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                        <nav class="d-flex justify-content-between" style="float: right">
                            {{ knp_pagination_render(activities) }}
                        </nav>
                        <small class="text-muted">{{ 'Showing'|trans }} {{ activities|length }} {{ 'of' |trans }} {{ activities.getTotalItemCount }}</small>
                    </div>
                {% endif %}

            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {#    {{ encore_entry_script_tags('systemEvaluationActivities') }}#}
{% endblock %}
