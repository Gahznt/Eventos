<div class="stepsTab" data-step="2" style="display: {{ step == 2 ? 'block' : 'none' }};">
    <h1>{{ 'THEME_STEP2_HEAD'|trans }}</h1>
    {# <div class="alert alert-warning icon exclamation"> #}
    {# <h2 class="text-primary-alt m-0"> #}
    {# {{ 'RESEARCHER_WARNING_MSG'|trans }}. #}
    {# </h2> #}
    {# </div> #}

    {% import _self as formMacros %}

    {% macro fieldsetResearcher(defaultStep) %}
        <div class="g-collection-fieldset fieldsetBg mb-3">
            <h1 id="title">
                {{ 'RESEARCHER_DATA'|trans }}
            </h1>
            <div class="row">
                <div class="col-12 form-group">
                    <label for="researcher">{{ 'Encontre o Pesquisador'|trans }}</label>
                    {{ form_widget(defaultStep.researcher, {'attr': {'id':'researcher', 'class': 'form-control no-select2', 'data-api-url': path('user_search_by_document')}}) }}
                    <p class="text-muted">{{ 'Encontre o Pesquisador digitando o CPF/Passaporte'|trans }}</p>
                    {% if defaultStep.researcher.vars['errors']|length > 0 %}
                        <div class="form-error invalid-input">
                            {{ defaultStep.researcher.vars['errors'][0].message }}
                        </div>
                    {% endif %}
                </div>
                <div class="col-12 form-group">
                    <label for="biography">{{ 'Biography'|trans }}</label>
                    {% set maxLength = constant('App\\Bundle\\Base\\Form\\UserThemesResearchersType::BIOGRAPHY_WORD_COUNT_MAX') %}
                    {{ form_widget(defaultStep.biography,
                        {'attr': {
                            'id':'biography',
                            'class': 'form-control',
                            'rows': 3,
                            'data-max-number-words': maxLength,
                            'data-remaining-words-counter': '#' ~ defaultStep.biography.vars['id'] ~ '-remaining-words-counter'
                        }}
                    ) }}
                    <p class="text-right">{{ 'TEXT_REMAINING_WORDS'|trans }}: <span id="{{ defaultStep.biography.vars['id'] }}-remaining-words-counter">{{ maxLength }}</span></p>
                    {% if defaultStep.biography.vars['errors']|length > 0 %}
                        <div class="form-error invalid-input">
                            {{ defaultStep.biography.vars['errors'][0].message }}
                        </div>
                    {% endif %}

                </div>
                <div class="col-12 form-group">
                    <label for="curriculumLattesLink">{{ 'LATTES_LINK'|trans }}</label>
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text btn btn-primary-alt"><i class="fas fa-link"></i></span>
                        </div>
                        {{ form_widget(defaultStep.curriculumLattesLink, {'attr': {'class': 'form-control'}}) }}
                    </div>
                    {% if defaultStep.curriculumLattesLink.vars['errors']|length > 0 %}
                        <div class="form-error invalid-input">
                            {{ defaultStep.curriculumLattesLink.vars['errors'][0].message }}
                        </div>
                    {% endif %}
                </div>

                <div class="col-12 form-group">
                    <div class="form-check">
                        {{ form_widget(defaultStep.isPostgraduateProgramProfessor, {'attr': {'class': 'form-check-input'}}) }}
                        <label class="form-check-label" for="{{ defaultStep.isPostgraduateProgramProfessor.vars.id }}">{{ 'Docente de Programa de Pós-Graduação'|trans }}</label>
                    </div>
                    {% if defaultStep.isPostgraduateProgramProfessor.vars['errors']|length > 0 %}
                        <div class="form-error invalid-input">
                            {{ defaultStep.isPostgraduateProgramProfessor.vars['errors'][0].message }}
                        </div>
                    {% endif %}
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <a class="g-collection-remove btn btn-sm btn-outline-danger float-left del">
                        <i class="fas fa-minus-circle"></i> {{ 'THEME_REMOVE_RES'|trans }}
                    </a>
                </div>
            </div>
        </div>
    {% endmacro %}

    {% set min = constant('App\\Bundle\\Base\\Form\\UserThemesType::USER_THEMES_RESEARCHERS_COUNT_MIN') %}
    {% set max = constant('App\\Bundle\\Base\\Form\\UserThemesType::USER_THEMES_RESEARCHERS_COUNT_MAX') %}
    {% set count = form.userThemesResearchers|length %}
    {% set index = count > 0 ? (form.userThemesResearchers|keys|last) + 1 : 0 %}
    {% set prototype %}
        {{ formMacros.fieldsetResearcher(form.userThemesResearchers.vars.prototype) }}
    {% endset %}

    <div id="researchers-container-form" class="g-collection {{ count == min ? 'g-collection-limit-min' }} {{ count == max ? 'g-collection-limit-max' }}" data-min="{{ min }}" data-max="{{ max }}" data-count="{{ count }}" data-index="{{ index }}" data-name="researchers" data-prototype="{{ prototype|e('html_attr') }}">
        <div class="g-collection-fieldsets">
            {% if form.userThemesResearchers|length > 0 %}
                {% for fieldset in form.userThemesResearchers %}
                    {{ formMacros.fieldsetResearcher(fieldset) }}
                {% endfor %}
            {% elseif min > 0 %}
                {% for i in 0..(min-1) %}
                    {{ prototype|replace({'__name__': i})|raw }}
                {% endfor %}
            {% endif %}
        </div>

        {% if form.userThemesResearchers.vars['errors']|length > 0 %}
            <div class="form-error invalid-input">
                {{ form.userThemesResearchers.vars['errors'][0].message }}
            </div>
        {% endif %}

        <div class="row">
            <div class="col-lg-12">
                <a class="g-collection-add btn btn-sm btn-primary float-right">
                    {{ 'THEME_ADD_RES'|trans }}
                    <i class="fas fa-plus-circle"></i>
                </a>
            </div>
        </div>
    </div>
</div>
